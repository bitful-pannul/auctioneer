<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">
  <link rel="icon"
    href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzc5IiBoZWlnaHQ9IjUxNCIgdmlld0JveD0iMCAwIDc3OSA1MTQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgICA8c3R5bGU+CiAgICAgICAgQG1lZGlhIChwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaykgewogICAgICAgICAgICBzdmcgeyBmaWxsOiB3aGl0ZTsgfQogICAgICAgIH0KICAgICAgICBAbWVkaWEgKHByZWZlcnMtY29sb3Itc2NoZW1lOiBsaWdodCkgewogICAgICAgICAgICBzdmcgeyBmaWxsOiBibGFjazsgfQogICAgICAgIH0KICAgIDwvc3R5bGU+CiAgICA8cGF0aCBkPSJNNzUzLjA5MiA1LjkxOTMyQzc1Ni41NTcgNS4wOTk3NiA3NTUuOTYyIC0wLjAwMDEyMjA3IDc1Mi40MDEgLTAuMDAwMTIyMDdINDI2LjAwMUM0MjQuNzU1IC0wLjAwMDEyMjA3IDQyMy42MzkgMC43NzAyNyA0MjMuMTk3IDEuOTM1MzVMMjM2Ljk2OCA0OTIuNkMyMzUuNzI5IDQ5NS44NjUgMjQwLjEyMyA0OTguMjU1IDI0Mi4xOTEgNDk1LjQ0MUw1NjkuMzU3IDUwLjExMzJDNTY5Ljc3OCA0OS41MzkyIDU3MC4zOTEgNDkuMTMzOSA1NzEuMDg0IDQ4Ljk3TDc1My4wOTIgNS45MTkzMloiLz4KICAgIDxwYXRoIGQ9Ik0xMS45NjY1IDQwLjIyODhDOS4xMDk0OSAzOC43NzcgMTAuMjEzNSAzNC40NTgzIDEzLjQxNjcgMzQuNTU1N0w0MDQuMjczIDQ2LjQzNjdDNDA2LjMzNCA0Ni40OTkzIDQwNy43MTkgNDguNTc0OSA0MDYuOTg2IDUwLjUwMjNMMzQ3LjQzOCAyMDYuOTgxQzM0Ni44MDQgMjA4LjY0NyAzNDQuODY1IDIwOS4zOTYgMzQzLjI3NSAyMDguNTg4TDExLjk2NjUgNDAuMjI4OFoiLz4KPC9zdmc+Cg==">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin-allow-popups" />
  <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
  <title>Initial Configuration</title>
  <style>
    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: 20vw;
      min-width: 10rem;
      background-color: black;
      color: #fff;
      text-align: left;
      border-radius: 0.5rem;
      padding: 1rem;
      position: absolute;
      z-index: 1;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      white-space: normal;
      overflow-y: auto;
      max-height: 30vh;
      font-size: 0.8rem;
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }

    body,
    html {
      margin: 0;
      padding: 0;
      font-family: 'Montserrat', sans-serif;
      background-color: #f0f2f5;
      color: #333;
      line-height: 1.6;
    }

    main {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column; /* Align fields vertically */
      align-items: center; /* Center-align the content */
    }

    h1 {
      font-size: 24px;
      color: #333;
      align-self: flex-start; /* Align title to the start */
    }

    label {
      font-weight: 500;
      margin-top: 15px;
      align-self: flex-start; /* Align labels to the start */
    }

    input[type="text"],
    input[type="password"],
    button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    button {
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      margin-top: 20px;
    }

    button:hover {
      background-color: #0056b3;
    }

    .tooltip {
      cursor: help;
    }

    @media (max-width: 768px) {
      main {
        padding: 15px;
      }
    }
  </style>
</head>

<body>
  <main class="col" id="initial-config">
    <h1>Initial Configuration</h1>
    <form id="config-form" class="col">
      <label for="openai-key">OpenAI API Key <span class="tooltip">?
          <span class="tooltiptext">
            1. Visit OpenAI's signup page.<br>
            2. Create an account and navigate to API section.<br>
            3. Click "New API Key" to generate a key.<br>
            4. Securely copy the API key displayed.<br>
            5. Type 'y' to proceed with entering the API key.<br>
            6. Paste the API key into the input.
          </span>
        </span></label>
      <input id="openai-key" required="" name="openai-key" placeholder="OpenAI API Key" value="">

      <label for="telegram-bot-api-key">Telegram Bot API Key <span class="tooltip">?
          <span class="tooltiptext">
            1. Open Telegram and search for "@BotFather".<br>
            2. Start a conversation and type `/newbot`.<br>
            3. Follow prompts to create a new bot.<br>
            4. Securely copy the API key displayed.<br>
            5. Type 'y' to proceed with entering the bot API key.<br>
            6. Paste the bot API key into the input.
          </span>
        </span></label>
      <input id="telegram-bot-api-key" required="" name="telegram-bot-api-key" placeholder="Telegram Bot API Key"
        value="">

      <label for="private-wallet-address">Private Wallet Address <span class="tooltip">?
          <span class="tooltiptext">
            1. Choose a wallet provider and create a new wallet.<br>
            2. Securely go through the wallet creation process.<br>
            3. Access your wallet to find your Ethereum address.<br>
            4. **Never share your private key.**<br>
            5. Type 'y' to proceed with entering your Ethereum address.<br>
            6. Use your Ethereum address as directed.
          </span>
        </span></label>
      <input id="private-wallet-address" required="" name="private-wallet-address" placeholder="Private Wallet Address"
        value="">
      <button type="submit" form="config-form">Submit</button>
    </form>
  </main>
  <main class="col" id="nft-manager" style="display: none;">
    <h1>NFT Manager</h1>
    <form id="nft-manager-form" class="col" onsubmit="submitNFT(event)">
      <label for="nft-name">NFT Name <span class="tooltip">?
          <span class="tooltiptext">
            The name of the NFT. This should be a unique and descriptive title for the NFT you're managing.
          </span>
        </span></label>
      <input id="nft-name" required="" name="nft-name" placeholder="NFT Name" value="">
      <label for="nft-address">Address <span class="tooltip">?
          <span class="tooltiptext">
            Smart contract address of the NFT. It uniquely identifies the contract that manages the NFTs you're
            declaring.
          </span>
        </span></label>
      <input id="nft-address" required="" name="nft-address" placeholder="NFT Contract Address" value="">

      <label for="nft-id">NFT ID <span class="tooltip">?
          <span class="tooltiptext">
            The unique identifier for the specific NFT within its collection.
          </span>
        </span></label>
      <input id="nft-id" required="" name="nft-id" placeholder="NFT ID" value="">

      <label for="chain-id">Chain ID <span class="tooltip">?
          <span class="tooltiptext">
            Identifies the specific blockchain network (e.g., Ethereum Mainnet, Polygon) your NFT exists on. Each chain
            has a unique ID to ensure transactions are processed on the correct network. For example, 1 for Ethereum,
            137 for Polygon.
          </span>
        </span></label>
      <input id="chain-id" required="" name="chain-id" placeholder="Chain ID" value="">

      <label for="nft-description">Description of NFT (optional) <span class="tooltip">?
          <span class="tooltiptext">
            Additional description you'll give to the bot for the sale of that NFT. Can be a backstory, or anything you
            want.
          </span>
        </span></label>
      <textarea id="nft-description" name="nft-description" placeholder="NFT Description"></textarea>

      <label for="sell-prompt">Custom prompt on how to sell it (optional) <span class="tooltip">?
          <span class="tooltiptext">
            Give instructions on what the bot should do to sell it. For example, being greedy vs lenient.
          </span>
        </span></label>
      <textarea id="sell-prompt" required="" name="sell-prompt" placeholder="Custom Selling Instructions"></textarea>

      <label for="min-price">Min Price <span class="tooltip">?
          <span class="tooltiptext">
            The minimum price for the NFT. No contract lower than that price will be generated, and the bot will try to
            get more than the price out of the auction.
          </span>
        </span></label>
      <input id="min-price" required="" name="min-price" placeholder="Minimum Price" value="">

      <button type="submit">Submit NFT</button>
    </form>
  </main>
  <script>
    window.onload = async function () {
      console.log("Fetching status on window load."); // Added for debugging
      await fetchStatus();
      console.log("Status fetched successfully."); // Added for debugging
    }

    async function fetchStatus() {
      const response = await fetch("/auctioneer:auctioneer:template.os/status", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ "status": "config" }),
      });
      const data = await response.json();
      if (data.status === "config") {
        document.getElementById("initial-config").style.display = "block";
        document.getElementById("nft-manager").style.display = "none"; // Ensure NFT Manager is hidden when showing config
        prepareConfigFormEventListener();
      } else if (data.status === "manage-nfts") {
        document.getElementById("nft-manager").style.display = "block";
        document.getElementById("initial-config").style.display = "none"; // Ensure config is hidden when showing NFT Manager
      } else {
        console.error("Unknown status:", data);
      }
    }

    async function submitConfig(openaiKey, telegramKey, walletAddress) {
      const result = await fetch("/auctioneer:auctioneer:template.os/config", {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ "openai_key": openaiKey, "telegram_bot_api_key": telegramKey, "private_wallet_address": walletAddress }),
      });
      const data = await result.json();
      console.debug("Response message:", data.message); // Debugging data.message
      document.getElementById("initial-config").style.display = "none"; // Hide initial configuration form
      document.getElementById("nft-manager").style.display = "block"; // Display NFT Manager view
    }

    function prepareConfigFormEventListener() {
      const form = document.getElementById("config-form");
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        e.stopPropagation();
        const openaiKey = document.getElementById("openai-key").value;
        const telegramKey = document.getElementById("telegram-bot-api-key").value;
        const walletAddress = document.getElementById("private-wallet-address").value;
        submitConfig(openaiKey, telegramKey, walletAddress);
      });
    }

    function submitNFT(event) {
      event.preventDefault();
      const nftName = document.getElementById("nft-name").value;
      const nftAddress = document.getElementById("nft-address").value;
      const nftId = document.getElementById("nft-id").value;
      const chainId = document.getElementById("chain-id").value;
      const nftDescription = document.getElementById("nft-description").value;
      const sellPrompt = document.getElementById("sell-prompt").value;
      const minPrice = document.getElementById("min-price").value;

      if (!nftName || !nftAddress || !nftId || !chainId || !minPrice) {
        alert("Please fill out all fields before submitting.");
        return;
      }

      fetch("/auctioneer:auctioneer:template.os/addnft", {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          "nft_name": nftName,
          "nft_address": nftAddress,
          "nft_id": parseInt(nftId, 10),
          "chain_id": parseInt(chainId, 10),
          "nft_description": nftDescription,
          "sell_prompt": sellPrompt,
          "min_price": parseFloat(minPrice)
        }),
      })
        .then(response => response.json())
        .then(data => {
          console.log("NFT submission successful:", data);
          // Handle success response, e.g., showing a success message or redirecting
        })
        .catch(error => {
          console.error("Failed to submit NFT:", error);
          // Handle error, e.g., showing an error message
        });
    }
  </script>
</body>

</html>

